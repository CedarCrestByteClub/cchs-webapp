<html>
	<head>
		<script src="http://www.parsecdn.com/js/parse-1.6.2.min.js"></script>
		<script type="text/javascript">Parse.initialize("1nbCZcm4WHUpYs0C89oTo231mhcpL2LRa5KfsYtw", "nNWuXfGI2ujbWBzxd5Om3F3OgFIIZRfvonOxfdEc");</script>
		<link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.css">
		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="js/jquery.mobile-1.4.5.js"></script>
		<link rel="stylesheet" type="text/css" href="css/theme.css">
		<script src="js/menu.js"></script>
		<style>
			th {
				font-size:3vh;
			}
			span {
				display:table-cell;
				height:100%;
				width:100%;
				padding:0;
				margin:0;
				text-align:center;
				vertical-align:middle;
				font-size:3vh;
			}
			.divFit {
				height:100%;
				display:table-cell;
				text-align:center;
			}
			.subDiv {
				display:table;
				width:100%;
				height:100%;
			}
		</style>
	</head>
	<body>
		<div style="height:100%;width:100%;min-height:100%;position:absolute;">
			<div id="holder" style="display:none;z-index:1000;width:50%;height:100%;overflow-y: hidden;overflow-x:hidden;position:fixed;">
				<div id="menu" align="center" style="overflow-y:auto;overflow-x:hidden;width:105%;height:100%;min-height:100%;background-color:white;">
					<table id="contentTable" class="sideMenu">
						<tr><td><div id="imageHolder" style="width:100%;height:200px;"><img src="img/launch.jpg" id="stretchImage"></div></td></tr>
						<tr class="rows"><td><a id="linkOne" data-ajax="false"><div class="menuItem"><span id="spanOne"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkTwo" data-ajax="false"><div class="menuItem"><span id="spanTwo"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkThree" data-ajax="false"><div class="menuItem"><span id="spanThree"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkFour" data-ajax="false"><div class="menuItem"><span id="spanFour"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkFive" data-ajax="false"><div class="menuItem"><span id="spanFive"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkSix" data-ajax="false"><div class="menuItem"><span id="spanSix"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkSeven" data-ajax="false"><div class="menuItem"><span id="spanSeven"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkEight" data-ajax="false"><div class="menuItem"><span id="spanEight"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkNine" data-ajax="false"><div class="menuItem"><span id="spanNine"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkTen" data-ajax="false"><div class="menuItem"><span id="spanTen"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkEleven" data-ajax="false"><div class="menuItem"><span id="spanEleven"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkTwelve" data-ajax="false"><div class="menuItem"><span id="spanTwelve"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkThirteen" data-ajax="false"><div class="menuItem"><span id="spanThirteen"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkFourteen" data-ajax="false"><div class="menuItem"><span id="spanFourteen"></span></div></a></td></tr>
						<tr class="rows"><td><a id="linkFifteen" data-ajax="false"><div class="menuItem"><span id="spanFifteen"></span></div></a></td></tr>
					</table>
				</div>
			</div>
			<div id="holder2" style="width:100%;z-index:10;position:absolute;display:inline;overflow-y:hidden;overflow-x:hidden;height:100%;min-height:100%;background-color:#4A4A4A;">
				<div id="content" style="overflow-y:auto;overflow-x:hidden;width:102%;height:100%;">
					<div id="contain" style="width:100%;height:100%;">
						<div style="width:100%;height:20%;text-align:center;display:table;">
							<div class="divFit" style="width:50%;"><div class="subDiv"><span id="activeSpan">Active</span></div></div>
							<div class="divFit" style="width:50%;"><div class="subDiv"><span id="growthSpan">Growth</span></div></div>
						</div>
						<div style="width:100%;height:30%;text-align:center;display:table;">
							<div class="divFit" style="width:100%;"><div class="subDiv"><span style="background-color:#9A9A9A;color:#000000;">Admin Data Control Center</span></div></div>
						</div>
						<table id="optionsTable" style="width:100%;height:50%;display:none;">
							<tr><td onclick="toDaily()">Daily Analytics</td></tr>
							<tr><td onclick="toPage()">Page Analytics</td></tr>
							<tr><td onclick="toUser()">User Analytics</td></tr>
							<tr><td onclick="toFlappy()">Flappy Falcon Leaderboard</td></tr>
						</table>
					</div>
					<div id="information" style="width:100%;height:100%;display:none;">
						<div id="backButton" style="width:100%;height:10%;text-align:center;font-size:5vh;display:table;" onclick="toHome()"><span style="vertical-align:middle;text-align:center;display:table-cell;">Back</span></div>
						<table id="infoTable">
							
						</table>
					</div>
				</div>
			</div>
		</div>
		
		<script>
			var infoTable = document.getElementById("infoTable");
			var contain = document.getElementById("contain");
			var information = document.getElementById("information");
			var daily = [];
			var page = [];
			var user = [];
			var flappy = [];
			var date = "";
			start();
			
			function start() {
				var today = new Date();
				var dd = today.getDate();
				var mm = (today.getMonth()+1); //January is 0!
				var yyyy = today.getFullYear();
				dd -= 1;
				if(dd == 0) {
					mm -= 1;
					switch(mm) {
						case 9,4,6,11:
							dd = 30;
							break;
						case 1,3,5,7,8,9,10,12:
							dd = 31;
						case 2:
							if(yyyy % 4 == 0) {dd = 29;}
							else {dd = 28;}
							break;
						case 0:
							mm = 12;
							dd = 31;
							yyyy -= 1;
					}
				}
				dd = dd.toString();
				mm = mm.toString();
				yyyy = yyyy.toString();
				if(parseInt(dd)<10) {dd='0'+dd;} 	
				if(parseInt(mm)<10) {mm='0'+mm;}
				date = mm+'/'+dd+'/'+yyyy;
			
				var Analytics = Parse.Object.extend("Analytics");
				var PageAnalytics = Parse.Object.extend("PageAnalytics");
				var UserIDs = Parse.Object.extend("UserIDs");
				var Leaderboard = Parse.Object.extend("Leaderboard");
				var aQuery = new Parse.Query(Analytics);
				var pQuery = new Parse.Query(PageAnalytics);
				var uQuery = new Parse.Query(UserIDs);
				var lQuery = new Parse.Query(Leaderboard);
				aQuery.limit(1000);
				pQuery.limit(1000);
				uQuery.limit(1000);
				lQuery.limit(1000);
				pQuery.equalTo("Final", 1);
				aQuery.find().then(function(results) {
					for(i = 0; i < results.length; i++) {
						daily.push(results[i]);
					}
					pQuery.find().then(function(results) {
						for(i = 0; i < results.length; i++) {
							page.push(results[i]);
						}
						uQuery.find().then(function(results) {
							for(i = 0; i < results.length; i++) {
								user.push(results[i]);
							}
							lQuery.find().then(function(results) {
								for(i = 0; i < results.length; i++) {
									flappy.push(results[i]);
								}
								load();
								user = sortArray(user);
								flappy = sortScores(flappy);
							});
						});
					});
				});
			}
			
			function load() {
				for(i = 0; i < daily.length; i++) {
					if(date == daily[i].get("Date")) {
						var a = daily[i].get("Active");
						var t = daily[i].get("Total");
						var p = parseInt(10000 * a / t) / 100;
						document.getElementById("activeSpan").innerHTML = "Active/Total (" + date + ") " + a + "/" + t + "/" + p + "%";
						var dayNum = daily[i].get("dayNum");
						dayNum -= 30;
						if(dayNum < 1) {dayNum = 1;}
						var oldDay;
						for(j = 0; j < daily.length; j++) {
							if(daily[j].get("dayNum") == dayNum) {
								oldDay = daily[j];
							}
						}
						var g = t - oldDay.get("Total");
						var gp = parseInt(10000 * g / oldDay.get("Total")) / 100;
						document.getElementById("growthSpan").innerHTML = "Growth (" + oldDay.get("Date") + "-" + date + ") " + g + "/" + gp + "%";
					}
				}
				document.getElementById("optionsTable").style.display = "table";
			}
		
			function toDaily() {
				contain.style.display = "none";
				information.style.display = "block";
				
				var th1 = document.createElement("th");
				th1.innerHTML = "Date";
				infoTable.appendChild(th1);
				var th2 = document.createElement("th");
				th2.innerHTML = "Active";
				infoTable.appendChild(th2);
				var th3 = document.createElement("th");
				th3.innerHTML = "Total";
				infoTable.appendChild(th3);
				
				for(i = 0; i < daily.length; i++) {
					var tr = document.createElement("tr");
					var td1 = document.createElement("td");
					var td2 = document.createElement("td");
					var td3 = document.createElement("td");
					td1.innerHTML = daily[i].get("Date");
					td2.innerHTML = daily[i].get("Active");
					td3.innerHTML = daily[i].get("Total");
					tr.appendChild(td1);
					tr.appendChild(td2);
					tr.appendChild(td3);
					infoTable.appendChild(tr);
				}
			}
			
			function toPage() {
				contain.style.display = "none";
				information.style.display = "block";
				
				var th1 = document.createElement("th");
				th1.innerHTML = "Page";
				infoTable.appendChild(th1);
				var th2 = document.createElement("th");
				th2.innerHTML = "Hits";
				infoTable.appendChild(th2);
				
				var pages = ["Home", "Sport", "Lunch", "Store", "Club", "Calendar", "Planner", "Talon", "News", "Map", "Closing", "Flappy", "About"];
				for(i = 0; i < pages.length; i++) {
					var tr = document.createElement("tr");
					var td1 = document.createElement("td");
					var td2 = document.createElement("td");
					td1.innerHTML = pages[i];
					td2.innerHTML = page[0].get(pages[i]);
					tr.appendChild(td1);
					tr.appendChild(td2);
					infoTable.appendChild(tr);
				}
			}
			
			function toUser() {
				contain.style.display = "none";
				information.style.display = "block";
				
				var th1 = document.createElement("th");
				th1.innerHTML = "UUID";
				infoTable.appendChild(th1);
				var th2 = document.createElement("th");
				th2.innerHTML = "Active";
				infoTable.appendChild(th2);
				var th3 = document.createElement("th");
				th3.innerHTML = "Version";
				infoTable.appendChild(th3);
				
				for(i = 0; i < user.length; i++) {
					var tr = document.createElement("tr");
					var td1 = document.createElement("td");
					var td2 = document.createElement("td");
					var td3 = document.createElement("td");
					td1.innerHTML = user[i].get("uuid");
					td2.innerHTML = user[i].get("active");
					var val = "";
					try {
						val = user[i].get("version").toString();
						if(val == "2") {val = "2.0";}
						td3.innerHTML = val;
					}
					catch(e) {
						td3.innerHTML = "1.2";
					}
					tr.appendChild(td1);
					tr.appendChild(td2);
					tr.appendChild(td3);
					infoTable.appendChild(tr);
				}
			}
		
			function toFlappy() {
				contain.style.display = "none";
				information.style.display = "block";
				
				var th1 = document.createElement("th");
				th1.innerHTML = "Name";
				infoTable.appendChild(th1);
				var th2 = document.createElement("th");
				th2.innerHTML = "Score";
				infoTable.appendChild(th2);
				var th3 = document.createElement("th");
				th3.innerHTML = "Visible";
				infoTable.appendChild(th3);
				
				for(i = 0; i < flappy.length; i++) {
					var tr = document.createElement("tr");
					var td1 = document.createElement("td");
					var td2 = document.createElement("td");
					var td3 = document.createElement("td");
					td1.innerHTML = flappy[i].get("Name");
					td2.innerHTML = flappy[i].get("Score");
					if(flappy[i].get("Display") == 1) {
						td3.innerHTML = "Yes";
					} else {
						td3.innerHTML = "No";
					}
					td3.setAttribute("id", flappy[i].id);
					td3.setAttribute("onclick", "changeDisplay(this.id)");
					tr.appendChild(td1);
					tr.appendChild(td2);
					tr.appendChild(td3);
					infoTable.appendChild(tr);
				}
			}
			
			function changeDisplay(id) {
				var board = Parse.Object.extend("Leaderboard");
				var query = new Parse.Query(board);
				query.equalTo("objectId", id);
				query.find().then(function(results) {
					var result = results[0];
					console.log(result);
					if(result.get("Display") == 0) {
						result.set("Display", 1);
					} else {
						result.set("Display", 0);
					}
					result.save().then(function(obj) {
						for(i = 0; i < flappy.length; i++) {
							if(obj.id == flappy[i].id) {
								flappy[i].set("Display", obj.get("Display"));
							}
						}
					});
					while(infoTable.rows.length > 0) {
						infoTable.deleteRow(0);
					}
					for(i = 0; i < flappy.length; i++) {
						var tr = document.createElement("tr");
						var td1 = document.createElement("td");
						var td2 = document.createElement("td");
						var td3 = document.createElement("td");
						td1.innerHTML = flappy[i].get("Name");
						td2.innerHTML = flappy[i].get("Score");
						if(flappy[i].get("Display") == 1) {
							td3.innerHTML = "Yes";
						} else {
							td3.innerHTML = "No";
						}
						td3.setAttribute("id", flappy[i].id);
						td3.setAttribute("onclick", "changeDisplay(this.id)");
						tr.appendChild(td1);
						tr.appendChild(td2);
						tr.appendChild(td3);
						infoTable.appendChild(tr);
					}
				});
			}
			
			function sortArray(array) 
			{
				var result = [];
				for(i = 0; i < array.length; i++) {
					if(i == 0) {
						result.push(array[i]);
						continue;
					}
					var index = 0;
					for(j = 0; j < result.length; j++) {
						var year1 = parseInt(array[i].get("active").substring(6));
						var year2 = parseInt(result[j].get("active").substring(6));
						if(year1 < year2) {}
						else if(year1 == year2) {
							var month1 = parseInt(array[i].get("active").substring(0,2));
							var month2 = parseInt(result[j].get("active").substring(0,2));
							//console.log("Month " + month1 + ", " + month2);
							if(month1 < month2) {}
							else if(month1 == month2) {
								//console.log("Month " + month1 + ", " + month2);
								var day1 = parseInt(array[i].get("active").substring(3,5));
								var day2 = parseInt(result[j].get("active").substring(3,5));
								if(day1 < day2) {}
								else if(day1 == day2) {}
								else {
									index++;
								}
							}
							else {
								index++;
							}
						}
						else {
							index++;
						}
					}
					result.splice(index,0,array[i]);
				}
				
				var temp = [];
				for(j = result.length - 1; j >= 0; j--) {
					temp.push(result[j]);
				}
				return temp;
			}
			
			function sortScores(array) {
				var result = [];
				for(i = 0; i < array.length; i++) {
					if(i == 0) {
						result.push(array[i]);
						continue;
					}
					var index = 0;
					for(j = 0; j < result.length; j++) {
						var score1 = array[i].get("Score");
						var score2 = result[j].get("Score");
						if(score1 < score2) {
							index++;
						} else {}
					}
					result.splice(index,0,array[i]);
				}
				
				return result;
			}
			
			function toHome() {
				contain.style.display = "block";
				information.style.display = "none";
				infoTable.parentNode.removeChild(infoTable);
				infoTable = document.createElement("table");
				information.appendChild(infoTable);
			}
		</script>
		
		<script>
				initialize();
			
				$(document).on("swiperight", function(event) {
					var content = document.getElementById("holder2");
					var menu = document.getElementById("holder");
					content.style.cssFloat = "right";
					menu.style.display = "inline";
					document.getElementById("content").style.width = "102%";
					var table = document.getElementById("contentTable");
					var ratio = window.devicePixelRatio;
					var rHeight = $(window).height() - (window.outerHeight - $(window).height());
					for(i = 1; i < table.rows.length; i++) {
						var tr = table.getElementsByTagName("tr")[i];
	    				var td = tr.getElementsByTagName("td")[0];
	    				td.style.height = "75px";
					}
					var div = document.getElementById("imageHolder");
					div.style.height = "150px";
					var image = document.getElementById("stretchImage");
					image.style.height = div.style.height;
					image.style.width = div.style.width;
				});
				
				$(document).on("swipeleft", function(event) {
					document.getElementById("holder").style.display = "none";
					document.getElementById("content").style.width = "102%";
				});
			</script>
	</body>
</html>